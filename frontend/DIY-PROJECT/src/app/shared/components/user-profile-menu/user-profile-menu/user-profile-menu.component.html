<button mat-button [matMenuTriggerFor]="userMenu" class="user-pill-trigger">
  
  <div class="avatar-container">
    @if (user.profilePicture) {
      <img [src]="'data:image/jpeg;base64,' + user.profilePicture" class="user-avatar-img">
    } @else {
      <div class="initials-avatar" [style.backgroundColor]="generateColor(user.userName)">
        {{ getFirstInitial(user.userName) }}
      </div>
    }
  </div>

  <div class="text-container">
    <span class="greeting">Hello,</span>
    <span class="username">{{ user.userName }}</span>
  </div>

  <mat-icon class="dropdown-arrow">expand_more</mat-icon>
</button>

<!-- Custom Menu Content -->
<mat-menu #userMenu="matMenu" xPosition="before" class="custom-user-menu">
  <div class="menu-header-card">
    <div class="menu-avatar-ring">
       <!-- Duplicate avatar logic for big display -->
       @if (user.profilePicture) {
         <img [src]="'data:image/jpeg;base64,' + user.profilePicture">
       } @else {
         <div class="menu-initials">{{ getFirstInitial(user.userName) }}</div>
       }
    </div>
    <div class="menu-user-details">
      <strong>{{ user.userName }}</strong>
      <small>{{ user.mail }}</small>
    </div>
  </div>

  <div class="menu-items">
    <a mat-menu-item routerLink="/profile">
      <mat-icon class="menu-icon-blue">account_circle</mat-icon>
      <span>My Profile</span>
    </a>
    <button mat-menu-item (click)="logout()">
      <mat-icon class="menu-icon-red">logout</mat-icon>
      <span>Sign Out</span>
    </button>
  </div>
</mat-menu>