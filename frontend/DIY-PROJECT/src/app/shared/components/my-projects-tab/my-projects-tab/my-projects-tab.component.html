<div class="projects-grid">
  
  @for (project of myProjects(); track project.id) {
    <div class="project-wrapper" [class.assign-mode-active]="challengeIdToAssign() !== null">
      
      <!-- The Card Component -->
      <app-project-card [project]="project"></app-project-card>

      <!-- Badge: Draft -->
      @if (project.isDraft) {
        <div class="status-badge draft">Draft</div>
      }

      <!-- Badge: Already Assigned (When in Assign Mode) -->
      @if (challengeIdToAssign() !== null && project.challengeId && project.challengeId !== challengeIdToAssign()) {
        <div class="status-badge busy">Assigned elsewhere</div>
      }

      <!-- OVERLAY: Challenge Assignment Mode -->
      @if (challengeIdToAssign() !== null) {
        <div class="actions-overlay assign-overlay">
          
          <!-- Case: Can Assign -->
          @if (!project.challengeId) {
            <button mat-fab class="fab-action link" (click)="assignProject(project.id)" matTooltip="Link to Challenge">
              <mat-icon>link</mat-icon>
            </button>
            <span class="overlay-label">Select Project</span>
          }
          
          <!-- Case: Locked/Already Assigned -->
          @if (project.challengeId) {
            <div class="locked-state">
              <mat-icon>lock</mat-icon>
              <span>Unavailable</span>
            </div>
          }
        </div>
      }

      <!-- OVERLAY: Standard Mode (Edit/Delete) -->
      @if (challengeIdToAssign() === null) {
        <div class="actions-overlay standard-overlay">
          <button mat-fab class="fab-action edit" [routerLink]="['/project/edit', project.id]" matTooltip="Edit">
            <mat-icon>edit</mat-icon>
          </button>
          
          <button mat-fab class="fab-action delete" (click)="deleteProject(project.id)" matTooltip="Delete">
            <mat-icon>delete_forever</mat-icon>
          </button>
        </div>
      }

    </div>
  } @empty {
    <!-- Empty State -->
    <div class="empty-state">
      <div class="icon-circle">
        <mat-icon>build_circle</mat-icon>
      </div>
      <h3>No projects yet</h3>
      <p>Share your creativity with the world.</p>
      <button mat-raised-button class="btn-create" routerLink="/create-project">
        Create First Project
      </button>
    </div>
  }
</div>